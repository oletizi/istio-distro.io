<!doctype html><html lang=en-us><head><meta charset=utf-8><title itemprop=name>How to Deploy Multiple Istio Ingress Gateways | GetIstio by Tetrate | Simple, safe enterprise-grade Istio distro</title><meta name=twitter:title content="How to Deploy Multiple Istio Ingress Gateways | GetIstio by Tetrate | Simple, safe enterprise-grade Istio distro"><meta itemprop=name content="How to Deploy Multiple Istio Ingress Gateways | GetIstio by Tetrate | Simple, safe enterprise-grade Istio distro"><meta name=application-name content="How to Deploy Multiple Istio Ingress Gateways | GetIstio by Tetrate | Simple, safe enterprise-grade Istio distro"><meta property="og:site_name" content="Tetrate Istio Distro"><meta name=description content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta itemprop=description content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta name=twitter:description content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta property="og:locale" content="en"><meta name=language content="En"><link rel=alternate hreflang=en href=/istio-in-practice/multiple-ingress-gateways/><link rel=alternate hreflang=zh href=/zh/istio-in-practice/multiple-ingress-gateways/><meta property="og:updated_time" content="2021-01-01T11:02:05+0600"><link rel=sitemap type=application/xml title=Sitemap href=/sitemap.xml><link href=/istio-in-practice/multiple-ingress-gateways/index.xml rel=alternate type=application/rss+xml title="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"><link href=/istio-in-practice/multiple-ingress-gateways/index.xml rel=feed type=application/rss+xml title="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"><meta property="og:type" content="website"><meta name=author content="Tetrate"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/istio.tetratelabs.io\/istio-in-practice\/multiple-ingress-gateways\/","sameAs":["","https:\/\/github.com\/tetratelabs\/getmesh"],"name":"Tetrate Istio Distro | Simple, safe enterprise-grade Istio","logo":"https://getistio.io/images/getistio-by-tetrate-logo.png"}</script><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content="@tetrateio"><meta name=twitter:creator content="@tetrateio"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><meta name=generator content="Hugo 0.85.0"><script async src="https://www.googletagmanager.com/gtag/js?id=G-P3J9XNBME4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-P3J9XNBME4')</script><link rel=preload href=/plugins/themify-icons/themify-icons.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/plugins/themify-icons/themify-icons.css></noscript><link rel=preload href=/plugins/search/auto-complete.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/plugins/search/auto-complete.css></noscript><link rel=preload href=/plugins/featherlight/featherlight.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/plugins/featherlight/featherlight.min.css></noscript><link rel=preload href=/css/bootstrap/bootstrap.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css></noscript><link rel=preload href=/scss/style.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/scss/style.css></noscript><link rel="shortcut icon" href=/images/getistio-favicon.png type=image/x-icon><link rel=icon href=/images/getistio-favicon.png type=image/x-icon><meta property="og:title" content="How to Deploy Multiple Istio Ingress Gateways"><meta property="og:description" content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta property="og:type" content="website"><meta property="og:url" content="https://istio.tetratelabs.io/istio-in-practice/multiple-ingress-gateways/"><meta property="og:image" content="https://istio.tetratelabs.io/images/twitter-card-new.png"><script async defer src=/js/turbolinks.min.js></script></head><body><header class="sticky-top navigation"><div class=my-container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><div class=navbar-brand-container><a class=navbar-brand href=/><img class="img-fluid logo-width" src=/images/tetrate-istio-distro-logo.png alt="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"></a>
<a class=github-button href=https://github.com/tetratelabs/getistio data-icon=octicon-star aria-label="Star tetratelabs/getmesh on GitHub">Star</a></div><button aria-label=Menu class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h4 text-white"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav mx-auto align-items-center"><li class=nav-item><a class=nav-link href=/getmesh-cli/>Docs</a></li><li class=nav-item><a class=nav-link href=/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=/community-events/>Community</a></li><li class=nav-item><a class=nav-link href=https://academy.tetrate.io target=_blank>Training</a></li><li class=nav-item><a class=nav-link href=https://func-e.io/ target=_blank>func-e</a></li><li class=nav-item><a class=nav-link href=https://www.istio.io/ target=_blank>Istio.io</a></li><li class=nav-link><select class=nav-item id=select-language onchange="location=this.value"><option id=en value=/istio-in-practice/multiple-ingress-gateways/ selected>En</option><option id=zh value=/zh/istio-in-practice/multiple-ingress-gateways/>中文</option></select></li></ul><div class="d-lg-none d-block"><a href=/download class="btn btn-sm btn-primary ml-lg-4">download</a></div></div><div class="d-lg-flex d-none"><a href=/download class="btn btn-sm btn-primary ml-lg-4">Download</a></div></nav></div></header><section class=pt-5><div class="container d-block d-sm-block d-lg-none"><div class="row justify-content-center mb-4"><div><button onclick=dropdownFunction() class="btn btn-primary dropdown-toggle nav-dropdown">Browse Docs
<span class=caret></span></button><ul id=mobileDropdownMenu class=dropdown-content><li data-nav-id=/introduction/ title=Introduction class="sidelist my-2"><a href=/introduction/>Introduction</a></li><li data-nav-id=/quickstart/ title="TID Quickstart" class="sidelist my-2"><a href=/quickstart/>TID Quickstart</a></li><li data-nav-id=/mgmt-tasks/ title="Common Management Tasks" class="sidelist my-2"><a href=/mgmt-tasks/>Common Management Tasks</a></li><li data-nav-id=/getmesh-cli/ title="GetMesh Documentation" class="sidelist my-2"><a href=/getmesh-cli/>GetMesh Documentation</a></li><li data-nav-id=/istio-in-practice/ title="Istio in Practice" class="sidelist parent my-2"><a href=/istio-in-practice/>Istio in Practice</a></li><li data-nav-id=/istio-ca-certs-integrations/ title="Istio CA Certs Integration" class="sidelist my-2"><a href=/istio-ca-certs-integrations/>Istio CA Certs Integration</a></li><li data-nav-id=/istio-cheatsheet/ title="Istio Hints and Tips" class="sidelist my-2"><a href=/istio-cheatsheet/>Istio Hints and Tips</a></li><li data-nav-id=/helm/ title="Helm Chart Deployment" class="sidelist my-2"><a href=/helm/>Helm Chart Deployment</a></li><li data-nav-id=/download/ title=Downloads class="sidelist my-2"><a href=/download/>Downloads</a></li><li data-nav-id=/faq/ title=FAQs class="sidelist my-2"><a href=/faq/>FAQs</a></li><li data-nav-id=/community/ title=Community class="sidelist my-2"><a href=/community/>Community</a></li><li data-nav-id=/fips-request/ title="FIPS Download Request" class="sidelist my-2"><a href=/fips-request/>FIPS Download Request</a></li></ul></div></div></div><div class="container shadow section-sm rounded docs-content"><div class=row><div class="col-lg-3 d-none d-md-none d-lg-block"><ul class=sidenav><li data-nav-id=/introduction/ title=Introduction class=sidelist><a href=/introduction/>Introduction</a><ul><li data-nav-id=/introduction/intro/ title class=sidelist><a href=/introduction/intro/></a></ul></li><li data-nav-id=/quickstart/ title="TID Quickstart" class=sidelist><a href=/quickstart/>TID Quickstart</a><ul><li data-nav-id=/quickstart/start/ title class=sidelist><a href=/quickstart/start/></a></ul></li><li data-nav-id=/mgmt-tasks/ title="Common Management Tasks" class=sidelist><a href=/mgmt-tasks/>Common Management Tasks</a><ul><li data-nav-id=/mgmt-tasks/install-istio-updates/ title="Install Istio Updates" class=sidelist><a href=/mgmt-tasks/install-istio-updates/>Install Istio Updates</a><li data-nav-id=/mgmt-tasks/install-istio-and-manage-multiple-istioctl/ title="Manage multiple istioctl" class=sidelist><a href=/mgmt-tasks/install-istio-and-manage-multiple-istioctl/>Manage multiple istioctl</a><li data-nav-id=/mgmt-tasks/config-validation/ title="Config Validation" class=sidelist><a href=/mgmt-tasks/config-validation/>Config Validation</a></ul></li><li data-nav-id=/getmesh-cli/ title="GetMesh Documentation" class=sidelist><a href=/getmesh-cli/>GetMesh Documentation</a><ul><li data-nav-id=/getmesh-cli/install/ title="Install GetMesh and Istio" class=sidelist><a href=/getmesh-cli/install/>Install GetMesh and Istio</a><ul><li data-nav-id=/getmesh-cli/install/install-istio/ title="Install Istio" class=sidelist><a href=/getmesh-cli/install/install-istio/>Install Istio</a><ul><li data-nav-id=/getmesh-cli/install/install-istio/prepare-eks-cluster/ title="Prepare AWS EKS cluster" class=sidelist><a href=/getmesh-cli/install/install-istio/prepare-eks-cluster/>Prepare AWS EKS cluster</a><li data-nav-id=/getmesh-cli/install/install-istio/aks-tid-deployment/ title="Install Istio on Azure AKS" class=sidelist><a href=/getmesh-cli/install/install-istio/aks-tid-deployment/>Install Istio on Azure AKS</a><li data-nav-id=/getmesh-cli/install/install-istio/eks-addon/ title="Install Istio in EKS with add-on" class=sidelist><a href=/getmesh-cli/install/install-istio/eks-addon/>Install Istio in EKS with add-on</a><li data-nav-id=/getmesh-cli/install/install-istio/deploy-gateway/ title="Deploy Istio Gateway in EKS" class=sidelist><a href=/getmesh-cli/install/install-istio/deploy-gateway/>Deploy Istio Gateway in EKS</a></ul></li><li data-nav-id=/getmesh-cli/install/install-and-update/ title="GetMesh installation and update" class=sidelist><a href=/getmesh-cli/install/install-and-update/>GetMesh installation and update</a><li data-nav-id=/getmesh-cli/install/post-install/ title="Once you've installed Istio" class=sidelist><a href=/getmesh-cli/install/post-install/>Once you've installed Istio</a></ul></li><li data-nav-id=/getmesh-cli/reference/ title=Reference class=sidelist><a href=/getmesh-cli/reference/>Reference</a><ul><li data-nav-id=/getmesh-cli/reference/getmesh/ title=GetMesh class=sidelist><a href=/getmesh-cli/reference/getmesh/>GetMesh</a><li data-nav-id=/getmesh-cli/reference/getmesh_check-upgrade/ title="getmesh check-upgrade" class=sidelist><a href=/getmesh-cli/reference/getmesh_check-upgrade/>getmesh check-upgrade</a><li data-nav-id=/getmesh-cli/reference/getmesh_config-validate/ title="getmesh config-validate" class=sidelist><a href=/getmesh-cli/reference/getmesh_config-validate/>getmesh config-validate</a><li data-nav-id=/getmesh-cli/reference/getmesh_default-hub/ title="getmesh default-hub" class=sidelist><a href=/getmesh-cli/reference/getmesh_default-hub/>getmesh default-hub</a><li data-nav-id=/getmesh-cli/reference/getmesh_fetch/ title="getmesh fetch" class=sidelist><a href=/getmesh-cli/reference/getmesh_fetch/>getmesh fetch</a><li data-nav-id=/getmesh-cli/reference/getmesh_gen-ca/ title="getmesh gen-ca" class=sidelist><a href=/getmesh-cli/reference/getmesh_gen-ca/>getmesh gen-ca</a><li data-nav-id=/getmesh-cli/reference/getmesh_help/ title="getmesh help" class=sidelist><a href=/getmesh-cli/reference/getmesh_help/>getmesh help</a><li data-nav-id=/getmesh-cli/reference/getmesh_istioctl/ title="getmesh istioctl" class=sidelist><a href=/getmesh-cli/reference/getmesh_istioctl/>getmesh istioctl</a><li data-nav-id=/getmesh-cli/reference/getmesh_list/ title="getmesh list" class=sidelist><a href=/getmesh-cli/reference/getmesh_list/>getmesh list</a><li data-nav-id=/getmesh-cli/reference/getmesh_prune/ title="getmesh prune" class=sidelist><a href=/getmesh-cli/reference/getmesh_prune/>getmesh prune</a><li data-nav-id=/getmesh-cli/reference/getmesh_show/ title="getmesh show" class=sidelist><a href=/getmesh-cli/reference/getmesh_show/>getmesh show</a><li data-nav-id=/getmesh-cli/reference/getmesh_switch/ title="getmesh switch" class=sidelist><a href=/getmesh-cli/reference/getmesh_switch/>getmesh switch</a><li data-nav-id=/getmesh-cli/reference/getmesh_version/ title="getmesh version" class=sidelist><a href=/getmesh-cli/reference/getmesh_version/>getmesh version</a></ul></li></ul></li><li data-nav-id=/istio-in-practice/ title="Istio in Practice" class="sidelist parent"><a href=/istio-in-practice/>Istio in Practice</a><ul><li data-nav-id=/istio-in-practice/prerequisites/ title=Prerequisites class=sidelist><a href=/istio-in-practice/prerequisites/>Prerequisites</a><li data-nav-id=/istio-in-practice/zero-downtime-releases/ title="How to do Zero-Downtime Releases" class=sidelist><a href=/istio-in-practice/zero-downtime-releases/>How to do Zero-Downtime Releases</a><li data-nav-id=/istio-in-practice/traffic-mirroring/ title="How to use Traffic Mirroring" class=sidelist><a href=/istio-in-practice/traffic-mirroring/>How to use Traffic Mirroring</a><li data-nav-id=/istio-in-practice/sticky-sessions/ title="How to use Sticky Sessions" class=sidelist><a href=/istio-in-practice/sticky-sessions/>How to use Sticky Sessions</a><li data-nav-id=/istio-in-practice/setting-up-ssl-certs/ title="How to set up SSL Certificates" class=sidelist><a href=/istio-in-practice/setting-up-ssl-certs/>How to set up SSL Certificates</a><li data-nav-id=/istio-in-practice/multiple-ingress-gateways/ title="How to Deploy Multiple Istio Ingress Gateways" class="sidelist parent active"><a href=/istio-in-practice/multiple-ingress-gateways/>How to Deploy Multiple Istio Ingress Gateways</a><li data-nav-id=/istio-in-practice/aws-cloudmap-integration/ title="Integrate AWS Cloud Map with Istio" class=sidelist><a href=/istio-in-practice/aws-cloudmap-integration/>Integrate AWS Cloud Map with Istio</a><li data-nav-id=/istio-in-practice/install-skywalking/ title="Integration with Apache SkyWalking" class=sidelist><a href=/istio-in-practice/install-skywalking/>Integration with Apache SkyWalking</a></ul></li><li data-nav-id=/istio-ca-certs-integrations/ title="Istio CA Certs Integration" class=sidelist><a href=/istio-ca-certs-integrations/>Istio CA Certs Integration</a><ul><li data-nav-id=/istio-ca-certs-integrations/acmpca-integration/ title="AWS Private CA Integration" class=sidelist><a href=/istio-ca-certs-integrations/acmpca-integration/>AWS Private CA Integration</a><li data-nav-id=/istio-ca-certs-integrations/gcp-cas-integration/ title="GCP CA Integration" class=sidelist><a href=/istio-ca-certs-integrations/gcp-cas-integration/>GCP CA Integration</a><li data-nav-id=/istio-ca-certs-integrations/cert-manager-integration/ title="cert-manager CA Integration" class=sidelist><a href=/istio-ca-certs-integrations/cert-manager-integration/>cert-manager CA Integration</a></ul></li><li data-nav-id=/istio-cheatsheet/ title="Istio Hints and Tips" class=sidelist><a href=/istio-cheatsheet/>Istio Hints and Tips</a><ul><li data-nav-id=/istio-cheatsheet/cheatsheet/ title class=sidelist><a href=/istio-cheatsheet/cheatsheet/></a></ul></li><li data-nav-id=/helm/ title="Helm Chart Deployment" class=sidelist><a href=/helm/>Helm Chart Deployment</a><ul><li data-nav-id=/helm/charts/ title class=sidelist><a href=/helm/charts/></a></ul></li><li data-nav-id=/download/ title=Downloads class=sidelist><a href=/download/>Downloads</a><ul><li data-nav-id=/download/downloads/ title class=sidelist><a href=/download/downloads/></a></ul></li><li data-nav-id=/faq/ title=FAQs class=sidelist><a href=/faq/>FAQs</a><ul><li data-nav-id=/faq/questions/ title class=sidelist><a href=/faq/questions/></a></ul></li><li data-nav-id=/community/ title=Community class=sidelist><a href=/community/>Community</a><ul><li data-nav-id=/community/event/getistio-inaugural/ title="What is GetIstio - Inaugural Community Meetup" class=sidelist><a href=/community/event/getistio-inaugural/>What is GetIstio - Inaugural Community Meetup</a><li data-nav-id=/community/event/istiocon-2021/ title="IstioCon 2021" class=sidelist><a href=/community/event/istiocon-2021/>IstioCon 2021</a><li data-nav-id=/community/event/getenvoy-deep-dive/ title="Effortless Envoy and WASM with GetEnvoy" class=sidelist><a href=/community/event/getenvoy-deep-dive/>Effortless Envoy and WASM with GetEnvoy</a><li data-nav-id=/community/event/getistio-deep-dive/ title="Istio the Easy Way with GetIstio" class=sidelist><a href=/community/event/getistio-deep-dive/>Istio the Easy Way with GetIstio</a><li data-nav-id=/community/event/tid-episode-003/ title="SSL Certificates in Istio Ingress Gateway" class=sidelist><a href=/community/event/tid-episode-003/>SSL Certificates in Istio Ingress Gateway</a><li data-nav-id=/community/event/tid-episode-004/ title="Deploying multiple Istio ingress gateways" class=sidelist><a href=/community/event/tid-episode-004/>Deploying multiple Istio ingress gateways</a><li data-nav-id=/community/event/tid-episode-006/ title="Istio Big Talk Episode 4" class=sidelist><a href=/community/event/tid-episode-006/>Istio Big Talk Episode 4</a><li data-nav-id=/community/event/tid-episode-005/ title="Security in Istio" class=sidelist><a href=/community/event/tid-episode-005/>Security in Istio</a><li data-nav-id=/community/event/tid-episode-007/ title="Istio Big Talk Episode 5" class=sidelist><a href=/community/event/tid-episode-007/>Istio Big Talk Episode 5</a><li data-nav-id=/community/event/tid-episode-008/ title="Istio Weekly Episode 6: Envoy Fundamentals" class=sidelist><a href=/community/event/tid-episode-008/>Istio Weekly Episode 6: Envoy Fundamentals</a><li data-nav-id=/community/event/tid-episode-009/ title="Episode 07: Developing Envoy Wasm Extensions" class=sidelist><a href=/community/event/tid-episode-009/>Episode 07: Developing Envoy Wasm Extensions</a><li data-nav-id=/community/event/tid-episode-010/ title="Istio in the enterprise: Solving security and scale challenges for microservices in Kubernetes" class=sidelist><a href=/community/event/tid-episode-010/>Istio in the enterprise: Solving security and scale challenges for microservices in Kubernetes</a><li data-nav-id=/community/event/tid-episode-011/ title="Episode 08: External CA with Istio" class=sidelist><a href=/community/event/tid-episode-011/>Episode 08: External CA with Istio</a><li data-nav-id=/community/event/tid-episode-012/ title="Episode 09: Customizing Istio metrics" class=sidelist><a href=/community/event/tid-episode-012/>Episode 09: Customizing Istio metrics</a><li data-nav-id=/community/event/tid-episode-013/ title class=sidelist><a href=/community/event/tid-episode-013/></a><li data-nav-id=/community/event/tid-episode-016/ title="Access Control for Microservices" class=sidelist><a href=/community/event/tid-episode-016/>Access Control for Microservices</a><li data-nav-id=/community/building-and-testing/ title="Building and Testing" class=sidelist><a href=/community/building-and-testing/>Building and Testing</a><li data-nav-id=/community/contributing/ title="Contributing to GetMesh" class=sidelist><a href=/community/contributing/>Contributing to GetMesh</a><li data-nav-id=/community/event/tid-episode-014/ title="Episode 11: Enterprise service mesh and why you need it" class=sidelist><a href=/community/event/tid-episode-014/>Episode 11: Enterprise service mesh and why you need it</a><li data-nav-id=/community/event/tid-episode-015/ title="Episode 12: How I started contributing to Istio and Envoy" class=sidelist><a href=/community/event/tid-episode-015/>Episode 12: How I started contributing to Istio and Envoy</a><li data-nav-id=/community/event/tid-episode-018/ title="Episode 15: Setting up Istio with external control plane" class=sidelist><a href=/community/event/tid-episode-018/>Episode 15: Setting up Istio with external control plane</a><li data-nav-id=/community/event/tid-episode-017/ title="Istio's new Wasm-based extension mechanism and ecosystem" class=sidelist><a href=/community/event/tid-episode-017/>Istio's new Wasm-based extension mechanism and ecosystem</a></ul></li><li data-nav-id=/fips-request/ title="FIPS Download Request" class=sidelist><a href=/fips-request/>FIPS Download Request</a><ul><li data-nav-id=/fips-request/fips/ title class=sidelist><a href=/fips-request/fips/></a></ul></li></ul></div><div class=col-lg-9><div class="px-lg-5 px-4"><h1 class="mb-4 font-weight-medium">How to Deploy Multiple Istio Ingress Gateways</h1><div class=content><p>When installing Istio, you have an option to pick the installation configuration profile to use. There are six installation profiles in the latest Istio release: default, demo, minimal, remote, empty, and preview.</p><p>Each of the profiles contains a different combination of components. For example, if you pick the minimal profile, you will only install <code>istiod</code>. No egress or ingress gateways will be installed. On the other hand, if we use the demo profile, Istio installs both ingress and egress gateway, in addition to <code>istiod</code>.</p><p>You can read more about the configuration profiles and check components that are part of the profiles on <a href=https://istio.io/latest/docs/setup/additional-setup/config-profiles/>Istio&rsquo;s docs page</a>.</p><p>Using <a href=https://istio.tetratelabs.io>Tetrate Istio Distro</a> you can pass in the installation configuration profile name to install Istio. For example, to install the demo profile, you can run this command:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>getmesh istioctl install --set <span style=color:#268bd2>profile</span><span style=color:#719e07>=</span>demo
</code></pre></div><p>You can additionally customize your Istio installation, regardless of the profile, by passing additional <code>--set &lt;key>=&lt;value></code> key/value pairs to the command.</p><h2 id=why-multiple-gateways>Why multiple gateways?</h2><p>Now before you go and create multiple ingress gateways (and multiple load balancers with your cloud provider), make sure you need it. Load balancers cost money, and it&rsquo;s yet another thing you need to manage. A single load balancer can work well with a lot of scenarios, however there are cases where you might have one private or internal load balancer and a second public one.</p><p>The scenario with a single load balancer would look like the figure below.</p><p><img src=single-load-balancer.png alt="Single Load Balancer"></p><p>We have a single ingress gateway - a Kubernetes service with LoadBalancer type and a Pod running Envoy. The fact that the service is of LoadBalancer type causes creating an actual load balancer instance and gives us an external IP address.</p><p>With the Istio Gateway resource, the <strong>host</strong> key in the configuration and attaching a Gateway to a VirtualService, we can expose multiple different services from the cluster on different domain names or sub-domains.</p><p>Now consider a different scenario where you want two separate load balancer instances running - shown in the figure below.</p><p><img src=two-load-balancers.png alt="Two Load Balancers"></p><p>In this scenario, we have two different external IPs that point to two different ingress gateways that run inside the same Kubernetes cluster. Let&rsquo;s look at how to achieve this.</p><h2 id=configuring-gateways>Configuring Gateways</h2><p>To get started, we need to look at the Istio configuration for a single ingress gateway that gets deployed when you use the default (or demo/preview profile). We can use the <code>profile dump</code> command to get the configuration:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>getmesh istioctl profile dump --config-path components.ingressGateways &gt; ingress-gateway.yaml
</code></pre></div><blockquote><p>If you see a message saying <code>proto: tag has too few fields: "-"</code>, you can safely ignore it. This is a <a href=https://github.com/istio/istio/issues/26751>known issue</a> that&rsquo;s being currently worked on.</p></blockquote><p>Here&rsquo;s how the contents of the <code>ingress-gateway.yaml</code> file look like:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#268bd2>enabled</span>: <span style=color:#cb4b16>true</span>
  <span style=color:#268bd2>k8s</span>:
    <span style=color:#268bd2>env</span>:
      - <span style=color:#268bd2>name</span>: ISTIO_META_ROUTER_MODE
        <span style=color:#268bd2>value</span>: standard
    <span style=color:#268bd2>hpaSpec</span>:
      <span style=color:#268bd2>maxReplicas</span>: <span style=color:#2aa198>5</span>
      <span style=color:#268bd2>metrics</span>:
        - <span style=color:#268bd2>resource</span>:
            <span style=color:#268bd2>name</span>: cpu
            <span style=color:#268bd2>targetAverageUtilization</span>: <span style=color:#2aa198>80</span>
          <span style=color:#268bd2>type</span>: Resource
      <span style=color:#268bd2>minReplicas</span>: <span style=color:#2aa198>1</span>
      <span style=color:#268bd2>scaleTargetRef</span>:
        <span style=color:#268bd2>apiVersion</span>: apps/v1
        <span style=color:#268bd2>kind</span>: Deployment
        <span style=color:#268bd2>name</span>: istio-ingressgateway
    <span style=color:#268bd2>resources</span>:
      <span style=color:#268bd2>limits</span>:
        <span style=color:#268bd2>cpu</span>: 2000m
        <span style=color:#268bd2>memory</span>: 1024Mi
      <span style=color:#268bd2>requests</span>:
        <span style=color:#268bd2>cpu</span>: 100m
        <span style=color:#268bd2>memory</span>: 128Mi
    <span style=color:#268bd2>service</span>:
      <span style=color:#268bd2>ports</span>:
        - <span style=color:#268bd2>name</span>: status-port
          <span style=color:#268bd2>port</span>: <span style=color:#2aa198>15021</span>
          <span style=color:#268bd2>protocol</span>: TCP
          <span style=color:#268bd2>targetPort</span>: <span style=color:#2aa198>15021</span>
        - <span style=color:#268bd2>name</span>: http2
          <span style=color:#268bd2>port</span>: <span style=color:#2aa198>80</span>
          <span style=color:#268bd2>protocol</span>: TCP
          <span style=color:#268bd2>targetPort</span>: <span style=color:#2aa198>8080</span>
        - <span style=color:#268bd2>name</span>: https
          <span style=color:#268bd2>port</span>: <span style=color:#2aa198>443</span>
          <span style=color:#268bd2>protocol</span>: TCP
          <span style=color:#268bd2>targetPort</span>: <span style=color:#2aa198>8443</span>
        - <span style=color:#268bd2>name</span>: tcp-istiod
          <span style=color:#268bd2>port</span>: <span style=color:#2aa198>15012</span>
          <span style=color:#268bd2>protocol</span>: TCP
          <span style=color:#268bd2>targetPort</span>: <span style=color:#2aa198>15012</span>
        - <span style=color:#268bd2>name</span>: tls
          <span style=color:#268bd2>port</span>: <span style=color:#2aa198>15443</span>
          <span style=color:#268bd2>protocol</span>: TCP
          <span style=color:#268bd2>targetPort</span>: <span style=color:#2aa198>15443</span>
    <span style=color:#268bd2>strategy</span>:
      <span style=color:#268bd2>rollingUpdate</span>:
        <span style=color:#268bd2>maxSurge</span>: <span style=color:#2aa198>100</span>%
        <span style=color:#268bd2>maxUnavailable</span>: <span style=color:#2aa198>25</span>%
  <span style=color:#268bd2>name</span>: istio-ingressgateway
</code></pre></div><p>The settings defined above are for the default Istio ingress gateway. The YAML includes the HorizontalPodAutoscaler configuration (<code>hpaSpec</code>), resource limits and requests (<code>resources</code>), service ports (<code>ports</code>), deployment strategy (<code>strategy</code>), and environment variables (<code>env</code>).</p><p>When installing Istio, we can define one or more Gateways directly in the IstioOperator resource. Here&rsquo;s an example of an Istio operator that deploys a single (default) ingress gateway:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2>apiVersion</span>: install.istio.io/v1alpha1
<span style=color:#268bd2>kind</span>: IstioOperator
<span style=color:#268bd2>spec</span>:
  <span style=color:#268bd2>components</span>:
    <span style=color:#268bd2>ingressGateways</span>:
      - <span style=color:#268bd2>name</span>: istio-ingressgateway
        <span style=color:#268bd2>enabled</span>: <span style=color:#cb4b16>true</span>
</code></pre></div><p>To deploy a second ingress gateway, we can add an entry under <code>ingressGateways</code> field. For example, let&rsquo;s add a second gateway called <code>istio-ingressgateway-staging</code> in the namespace <code>staging</code>:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2>apiVersion</span>: install.istio.io/v1alpha1
<span style=color:#268bd2>kind</span>: IstioOperator
<span style=color:#268bd2>spec</span>:
  <span style=color:#268bd2>components</span>:
    <span style=color:#268bd2>ingressGateways</span>:
      - <span style=color:#268bd2>name</span>: istio-ingressgateway
        <span style=color:#268bd2>enabled</span>: <span style=color:#cb4b16>true</span>
      - <span style=color:#268bd2>name</span>: istio-ingressgateway-staging
        <span style=color:#268bd2>namespace</span>: staging
        <span style=color:#268bd2>enabled</span>: <span style=color:#cb4b16>true</span>
</code></pre></div><p>Before we go and deploy this, we also need to modify the labels this new Gateway will use. Remember, if we don&rsquo;t specify anything, Istio uses the default Gateway configuration, and we will end up with two Gateways with the same labels, albeit in a different namespace.</p><p>The IstioOperator allows us to add new or modify existing labels by merely setting the <code>label</code> field. Here&rsquo;s how the updated IstioOperator looks like:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2>apiVersion</span>: install.istio.io/v1alpha1
<span style=color:#268bd2>kind</span>: IstioOperator
<span style=color:#268bd2>spec</span>:
  <span style=color:#268bd2>components</span>:
    <span style=color:#268bd2>ingressGateways</span>:
      - <span style=color:#268bd2>name</span>: istio-ingressgateway
        <span style=color:#268bd2>enabled</span>: <span style=color:#cb4b16>true</span>
      - <span style=color:#268bd2>name</span>: istio-ingressgateway-staging
        <span style=color:#268bd2>namespace</span>: staging
        <span style=color:#268bd2>enabled</span>: <span style=color:#cb4b16>true</span>
        <span style=color:#268bd2>label</span>:
          <span style=color:#268bd2>istio</span>: istio-ingressgateway-staging
</code></pre></div><p>This YAML ensures that the label <code>istio: istio-ingressgateway-staging</code> is applied to all resource Istio creates for the ingress gateway. Before we install the operator, we need to create the <code>staging</code> namespace first:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl create ns staging
</code></pre></div><p>Now we&rsquo;re ready to install Istio. Save the above YAML to <code>istio-2-gw.yaml</code> and use <code>getmesh</code> to install it:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ getmesh istioctl install -f istio-2-gw.yaml
This will install the Istio default profile with <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;Istio core&#34;</span> <span style=color:#2aa198>&#34;Istiod&#34;</span> <span style=color:#2aa198>&#34;Ingress gateways&#34;</span><span style=color:#719e07>]</span> components into the cluster. Proceed? <span style=color:#719e07>(</span>y/N<span style=color:#719e07>)</span> y
✔ Istio core installed
✔ Istiod installed
✔ Ingress gateways installed
✔ Installation <span style=color:#b58900>complete</span>
</code></pre></div><p>When the installation completes, you can list the Pods and Services in the <code>staging</code> namespace:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ kubectl get po,svc -n staging
NAME                                               READY   STATUS    RESTARTS   AGE
pod/istio-ingressgateway-staging-8b59464d7-fvlhx   1/1     Running   <span style=color:#2aa198>0</span>          5m30s

NAME                                   TYPE           CLUSTER-IP     EXTERNAL-IP     PORT<span style=color:#719e07>(</span>S<span style=color:#719e07>)</span>                                                      AGE
service/istio-ingressgateway-staging   LoadBalancer   10.96.13.200   XX.XXX.XXX.XX   15021:31259/TCP,80:31104/TCP,443:31853/TCP,15443:31053/TCP   5m29s
</code></pre></div><p>You&rsquo;ll notice a running <code>istio-ingressgateway-staging</code> Pod and a <code>istio-ingressgateway-staging</code> service of the type LoadBalancer and with an external IP that&rsquo;s different from the default ingress gateway that&rsquo;s running in the <code>istio-system</code> namespace.</p><h3 id=testing-multiple-istio-gateways>Testing multiple Istio Gateways</h3><p>Time to test the gateways! Make sure you have labeled the <code>default</code> namespace with <code>istio-injection=enabled</code> (see <a href=./prerequisites>Prerequisites</a>) and then use the snippet below to create a Service, Deployment, Gateway, and a VirtualService.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cat <span style=color:#2aa198>&lt;&lt; EOF | kubectl apply -f -
</span><span style=color:#2aa198>apiVersion: v1
</span><span style=color:#2aa198>kind: Service
</span><span style=color:#2aa198>metadata:
</span><span style=color:#2aa198>  name: nginx
</span><span style=color:#2aa198>  namespace: default
</span><span style=color:#2aa198>  labels:
</span><span style=color:#2aa198>    app: nginx
</span><span style=color:#2aa198>spec:
</span><span style=color:#2aa198>  ports:
</span><span style=color:#2aa198>  - port: 80
</span><span style=color:#2aa198>    name: http
</span><span style=color:#2aa198>  selector:
</span><span style=color:#2aa198>    app: nginx
</span><span style=color:#2aa198>---
</span><span style=color:#2aa198>apiVersion: apps/v1
</span><span style=color:#2aa198>kind: Deployment
</span><span style=color:#2aa198>metadata:
</span><span style=color:#2aa198>  name: nginx
</span><span style=color:#2aa198>  namespace: default
</span><span style=color:#2aa198>  labels:
</span><span style=color:#2aa198>    app: nginx
</span><span style=color:#2aa198>spec:
</span><span style=color:#2aa198>  replicas: 1
</span><span style=color:#2aa198>  selector:
</span><span style=color:#2aa198>    matchLabels:
</span><span style=color:#2aa198>      app: nginx
</span><span style=color:#2aa198>  template:
</span><span style=color:#2aa198>    metadata:
</span><span style=color:#2aa198>      labels:
</span><span style=color:#2aa198>        app: nginx
</span><span style=color:#2aa198>    spec:
</span><span style=color:#2aa198>      containers:
</span><span style=color:#2aa198>      - name: nginx
</span><span style=color:#2aa198>        image: nginx:alpine
</span><span style=color:#2aa198>        imagePullPolicy: IfNotPresent
</span><span style=color:#2aa198>        ports:
</span><span style=color:#2aa198>        - containerPort: 80
</span><span style=color:#2aa198>---
</span><span style=color:#2aa198>apiVersion: networking.istio.io/v1alpha3
</span><span style=color:#2aa198>kind: Gateway
</span><span style=color:#2aa198>metadata:
</span><span style=color:#2aa198>  name: gateway
</span><span style=color:#2aa198>  namespace: default
</span><span style=color:#2aa198>spec:
</span><span style=color:#2aa198>  selector:
</span><span style=color:#2aa198>    istio: ingressgateway
</span><span style=color:#2aa198>  servers:
</span><span style=color:#2aa198>  - port:
</span><span style=color:#2aa198>      number: 80
</span><span style=color:#2aa198>      name: http
</span><span style=color:#2aa198>      protocol: HTTP
</span><span style=color:#2aa198>    hosts:
</span><span style=color:#2aa198>    - &#39;*&#39;
</span><span style=color:#2aa198>---
</span><span style=color:#2aa198>apiVersion: networking.istio.io/v1alpha3
</span><span style=color:#2aa198>kind: VirtualService
</span><span style=color:#2aa198>metadata:
</span><span style=color:#2aa198>  name: nginx-1
</span><span style=color:#2aa198>  namespace: default
</span><span style=color:#2aa198>spec:
</span><span style=color:#2aa198>  hosts:
</span><span style=color:#2aa198>  - &#34;*&#34;
</span><span style=color:#2aa198>  gateways:
</span><span style=color:#2aa198>  - gateway
</span><span style=color:#2aa198>  http:
</span><span style=color:#2aa198>  - route:
</span><span style=color:#2aa198>    - destination:
</span><span style=color:#2aa198>        host: nginx
</span><span style=color:#2aa198>        port:
</span><span style=color:#2aa198>          number: 80
</span><span style=color:#2aa198>EOF</span>
</code></pre></div><p>Wait for the Pod to start, and open the first ingress gateway IP address in your browser. You can use this command to get the IP address:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl get svc istio-ingressgateway -n istio-system  -o <span style=color:#268bd2>jsonpath</span><span style=color:#719e07>=</span><span style=color:#2aa198>&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span>
</code></pre></div><p>You should get back the default &ldquo;Welcome to nginx!&rdquo; page. Let&rsquo;s see what happens if we try to open the external IP of the second ingress gateway we deployed. You can use a similar command as above to get the IP address by updating the service name and namespace:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl get svc istio-ingressgateway-staging -n staging  -o <span style=color:#268bd2>jsonpath</span><span style=color:#719e07>=</span><span style=color:#2aa198>&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span>
</code></pre></div><p>You won&rsquo;t be able to connect to the staging ingress gateway, and this is expected. We haven&rsquo;t deployed any Gateway resources that would configure the ingress. Let&rsquo;s update the label value to <code>istio-ingressgateway-staging</code> and re-deploy the Gateway resource:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cat <span style=color:#2aa198>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#2aa198>apiVersion: networking.istio.io/v1alpha3
</span><span style=color:#2aa198>kind: Gateway
</span><span style=color:#2aa198>metadata:
</span><span style=color:#2aa198>  name: gateway
</span><span style=color:#2aa198>  namespace: default
</span><span style=color:#2aa198>spec:
</span><span style=color:#2aa198>  selector:
</span><span style=display:block;width:100%;background-color:#19404a><span style=color:#2aa198>    istio: istio-ingressgateway-staging
</span></span><span style=color:#2aa198>  servers:
</span><span style=color:#2aa198>  - port:
</span><span style=color:#2aa198>      number: 80
</span><span style=color:#2aa198>      name: http
</span><span style=color:#2aa198>      protocol: HTTP
</span><span style=color:#2aa198>    hosts:
</span><span style=color:#2aa198>    - &#39;*&#39;
</span><span style=color:#2aa198>EOF</span>
</code></pre></div><p>This time, you should access the Nginx home page through the staging gateway, while the original gateway won&rsquo;t point to anything.</p><p>At this point, you could create a separate Gateway resource to control both ingress gateways independently.</p></div><nav class=pagination><a class="nav nav-prev" href=/istio-in-practice/setting-up-ssl-certs/><i class="ti-arrow-left mr-2"></i>
<span class="d-none d-md-block">How to set up SSL Certificates</span></a>
<a class="nav nav-next" href=/istio-in-practice/aws-cloudmap-integration/><span class="d-none d-md-block">Integrate AWS Cloud Map with Istio</span><i class="ti-arrow-right ml-2"></i></a></nav></div></div></div></div></section><footer><div class=container><div class="row align-items-center pb-0 footer-logo"><a class=navbar-brand href=/><img id=getistio-footer-logo class=img-fluid src=/images/tetrate-istio-distro-logo.png alt="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"></a>
<a href=https://www.tetrate.io target=_blank><img id=tetrate-footer-logo class=img-fluid src=/images/tetrate-logo.svg alt="Tetrate Logo"></a></div><div class="py-4 text-center"><div class=mb-4><ul class="list-inline social-icons text-lg-center text-center"><li class=list-inline-item><a href=https://www.tetrate.io/ target=_blank aria-label="Tetrate website"><i class=ti-world></i></a></li><li class=list-inline-item><a href=https://www.twitter.com/tetrateio target=_blank aria-label="Tetrate Twitter account"><i class=ti-twitter-alt></i></a></li><li class=list-inline-item><a href=https://www.github.com/tetratelabs target=_blank aria-label="Tetrate Github account"><i class=ti-github></i></a></li><li class=list-inline-item><a href=https://www.linkedin.com/company/tetrate/ target=_blank aria-label="Tetrate LinkedIn account"><i class=ti-linkedin></i></a></li></ul></div><small class=text-white>Support: Join our <a href=https://tetr8.io/tetrate-community target=_blank>#tid-and-getmesh Slack Channel</a> for Community Support</small><br><small class=text-white>License: Tetrate Istio Distro is an open source project and is released under Apache License 2.0 | <a href=https://www.tetrate.io/privacy target=_blank>Privacy Statement</a></small><br><small class=text-white>Official project site of istio is <a href=https://www.istio.io target=_blank>istio.io</a></small><br><small class=text-white>Copyright &copy; 2023 <a href=https://www.tetrate.io target=_blank>Tetrate</a> All rights reserved.</small></div></div></footer><script type=text/javascript>var indexURL="/index.json",baseurl="https://istio.tetratelabs.io/"</script><script src=/plugins/jQuery/jquery.min.js></script><script src=/plugins/bootstrap/bootstrap.min.js></script><script src=/plugins/featherlight/featherlight.min.js></script><script src=/plugins/clipboard/clipboard.min.js></script><script src=/plugins/match-height/jquery.matchHeight-min.js></script><script src=/plugins/search/auto-complete.js></script><script src=/plugins/search/search.js></script><script src=/plugins/search/lunr.min.js></script><script src=/plugins/search/fuse.min.js></script><script src=/plugins/search/mark.js></script><script src=/plugins/search/search-page.js></script><script src=/js/script.min.js></script><script src=/js/form.min.js></script><script type=text/javascript src="//js.hsforms.net/forms/v2.js?pre=1"></script><script async defer src=https://buttons.github.io/buttons.js></script></body></html>