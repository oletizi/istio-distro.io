<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title itemprop=name>如何设置 SSL 证书 | 简单、安全的企业级 Istio 发行版 | GetIstio 由 Tetrate 出品</title><meta name=twitter:title content="如何设置 SSL 证书 | 简单、安全的企业级 Istio 发行版 | GetIstio 由 Tetrate 出品"><meta itemprop=name content="如何设置 SSL 证书 | 简单、安全的企业级 Istio 发行版 | GetIstio 由 Tetrate 出品"><meta name=application-name content="如何设置 SSL 证书 | 简单、安全的企业级 Istio 发行版 | GetIstio 由 Tetrate 出品"><meta property="og:site_name" content="Tetrate Istio Distro"><meta name=description content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta itemprop=description content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta name=twitter:description content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta property="og:locale" content="zh"><meta name=language content="中文"><link rel=alternate hreflang=en href=/istio-in-practice/setting-up-ssl-certs/><link rel=alternate hreflang=zh href=/zh/istio-in-practice/setting-up-ssl-certs/><meta property="og:updated_time" content="2021-01-01T11:02:05+0600"><link rel=sitemap type=application/xml title=Sitemap href=/sitemap.xml><link href=/zh/istio-in-practice/setting-up-ssl-certs/index.xml rel=alternate type=application/rss+xml title="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"><link href=/zh/istio-in-practice/setting-up-ssl-certs/index.xml rel=feed type=application/rss+xml title="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"><meta property="og:type" content="website"><meta name=author content="Tetrate"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/istio.tetratelabs.io\/zh\/istio-in-practice\/setting-up-ssl-certs\/","sameAs":["","https:\/\/github.com\/tetratelabs\/getmesh"],"name":"Tetrate Istio Distro | Simple, safe enterprise-grade Istio","logo":"https://getistio.io/images/getistio-by-tetrate-logo.png"}</script><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content="@tetrateio"><meta name=twitter:creator content="@tetrateio"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><meta name=generator content="Hugo 0.85.0"><script async src="https://www.googletagmanager.com/gtag/js?id=G-P3J9XNBME4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-P3J9XNBME4')</script><link rel=preload href=/plugins/themify-icons/themify-icons.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/plugins/themify-icons/themify-icons.css></noscript><link rel=preload href=/plugins/search/auto-complete.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/plugins/search/auto-complete.css></noscript><link rel=preload href=/plugins/featherlight/featherlight.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/plugins/featherlight/featherlight.min.css></noscript><link rel=preload href=/css/bootstrap/bootstrap.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css></noscript><link rel=preload href=/scss/style.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/scss/style.css></noscript><link rel="shortcut icon" href=/images/getistio-favicon.png type=image/x-icon><link rel=icon href=/images/getistio-favicon.png type=image/x-icon><meta property="og:title" content="如何设置 SSL 证书"><meta property="og:description" content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta property="og:type" content="website"><meta property="og:url" content="https://istio.tetratelabs.io/zh/istio-in-practice/setting-up-ssl-certs/"><meta property="og:image" content="https://istio.tetratelabs.io/images/twitter-card-new.png"><script async defer src=/js/turbolinks.min.js></script></head><body><header class="sticky-top navigation"><div class=my-container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><div class=navbar-brand-container><a class=navbar-brand href=/zh><img class="img-fluid logo-width" src=/images/tetrate-istio-distro-logo.png alt="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"></a>
<a class=github-button href=https://github.com/tetratelabs/getistio data-icon=octicon-star aria-label="Star tetratelabs/getmesh on GitHub">Star</a></div><button aria-label=Menu class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h4 text-white"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav mx-auto align-items-center"><li class=nav-item><a class=nav-link href=/zh/getmesh-cli/>文档</a></li><li class=nav-item><a class=nav-link href=/zh/blog/>博客</a></li><li class=nav-item><a class=nav-link href=/zh/community-events/>社区</a></li><li class=nav-item><a class=nav-link href=https://academy.tetrate.io target=_blank>培训</a></li><li class=nav-item><a class=nav-link href=https://func-e.io/ target=_blank>func-e</a></li><li class=nav-item><a class=nav-link href=https://www.istio.io/ target=_blank>Istio.io</a></li><li class=nav-link><select class=nav-item id=select-language onchange="location=this.value"><option id=en value=/istio-in-practice/setting-up-ssl-certs/>En</option><option id=zh value=/zh/istio-in-practice/setting-up-ssl-certs/ selected>中文</option></select></li></ul><div class="d-lg-none d-block"><a href=/zh/download class="btn btn-sm btn-primary ml-lg-4">download</a></div></div><div class="d-lg-flex d-none"><a href=/zh/download class="btn btn-sm btn-primary ml-lg-4">下载</a></div></nav></div></header><section class=pt-5><div class="container d-block d-sm-block d-lg-none"><div class="row justify-content-center mb-4"><div><button onclick=dropdownFunction() class="btn btn-primary dropdown-toggle nav-dropdown">Browse Docs
<span class=caret></span></button><ul id=mobileDropdownMenu class=dropdown-content><li data-nav-id=/zh/getmesh-cli/ title="GetMesh 概览" class="sidelist my-2"><a href=/zh/getmesh-cli/>GetMesh 概览</a></li><li data-nav-id=/zh/config-validation/ title=配置验证 class="sidelist my-2"><a href=/zh/config-validation/>配置验证</a></li><li data-nav-id=/zh/istio-ca-certs-integrations/ title="Istio CA Certs 集成" class="sidelist my-2"><a href=/zh/istio-ca-certs-integrations/>Istio CA Certs 集成</a></li><li data-nav-id=/zh/istio-in-practice/ title="Istio 实践教程" class="sidelist parent my-2"><a href=/zh/istio-in-practice/>Istio 实践教程</a></li><li data-nav-id=/zh/ecosystem-partners/ title="生态 & 合作伙伴" class="sidelist my-2"><a href=/zh/ecosystem-partners/>生态 & 合作伙伴</a></li><li data-nav-id=/zh/istio-cheatsheet/ title="Istio 速查表" class="sidelist my-2"><a href=/zh/istio-cheatsheet/>Istio 速查表</a></li><li data-nav-id=/zh/faq/ title=FAQ class="sidelist my-2"><a href=/zh/faq/>FAQ</a></li><li data-nav-id=/zh/community/ title=社区 class="sidelist my-2"><a href=/zh/community/>社区</a></li><li data-nav-id=/zh/download/ title=下载 class="sidelist my-2"><a href=/zh/download/>下载</a></li></ul></div></div></div><div class="container shadow section-sm rounded docs-content"><div class=row><div class="col-lg-3 d-none d-md-none d-lg-block"><ul class=sidenav><li data-nav-id=/zh/getmesh-cli/ title="GetMesh 概览" class=sidelist><a href=/zh/getmesh-cli/>GetMesh 概览</a><ul><li data-nav-id=/zh/getmesh-cli/install-istio/ title="安装 Istio" class=sidelist><a href=/zh/getmesh-cli/install-istio/>安装 Istio</a><li data-nav-id=/zh/getmesh-cli/install-istio-updates/ title="安装 Istio 更新" class=sidelist><a href=/zh/getmesh-cli/install-istio-updates/>安装 Istio 更新</a><li data-nav-id=/zh/getmesh-cli/install-and-update-of-getistio/ title="安装和更新 GetMesh" class=sidelist><a href=/zh/getmesh-cli/install-and-update-of-getistio/>安装和更新 GetMesh</a><li data-nav-id=/zh/getmesh-cli/install-istio-and-manage-multiple-istioctl/ title="管理多个 istioctl" class=sidelist><a href=/zh/getmesh-cli/install-istio-and-manage-multiple-istioctl/>管理多个 istioctl</a><li data-nav-id=/zh/getmesh-cli/reference/ title=参考 class=sidelist><a href=/zh/getmesh-cli/reference/>参考</a><ul><li data-nav-id=/zh/getmesh-cli/reference/getmesh/ title=getmesh class=sidelist><a href=/zh/getmesh-cli/reference/getmesh/>getmesh</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_check-upgrade/ title="getmesh check-upgrade" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_check-upgrade/>getmesh check-upgrade</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_config-validate/ title="getmesh config-validate" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_config-validate/>getmesh config-validate</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_default-hub/ title="getmesh default-hub" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_default-hub/>getmesh default-hub</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_fetch/ title="getmesh fetch" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_fetch/>getmesh fetch</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_gen-ca/ title="getmesh gen-ca" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_gen-ca/>getmesh gen-ca</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_help/ title="getmesh help" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_help/>getmesh help</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_istioctl/ title="getmesh istioctl" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_istioctl/>getmesh istioctl</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_list/ title="getmesh list" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_list/>getmesh list</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_prune/ title="getmesh prune" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_prune/>getmesh prune</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_show/ title="getmesh show" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_show/>getmesh show</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_switch/ title="getmesh switch" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_switch/>getmesh switch</a><li data-nav-id=/zh/getmesh-cli/reference/getmesh_version/ title="getmesh version" class=sidelist><a href=/zh/getmesh-cli/reference/getmesh_version/>getmesh version</a></ul></li></ul></li><li data-nav-id=/zh/config-validation/ title=配置验证 class=sidelist><a href=/zh/config-validation/>配置验证</a><ul><li data-nav-id=/zh/config-validation/istio-config-validation/ title=配置验证详情 class=sidelist><a href=/zh/config-validation/istio-config-validation/>配置验证详情</a></ul></li><li data-nav-id=/zh/istio-ca-certs-integrations/ title="Istio CA Certs 集成" class=sidelist><a href=/zh/istio-ca-certs-integrations/>Istio CA Certs 集成</a><ul><li data-nav-id=/zh/istio-ca-certs-integrations/acmpca-integration/ title="ACM Private CA 集成" class=sidelist><a href=/zh/istio-ca-certs-integrations/acmpca-integration/>ACM Private CA 集成</a><li data-nav-id=/zh/istio-ca-certs-integrations/gcp-cas-integration/ title="GCP CAS 集成" class=sidelist><a href=/zh/istio-ca-certs-integrations/gcp-cas-integration/>GCP CAS 集成</a><li data-nav-id=/zh/istio-ca-certs-integrations/cert-manager-integration/ title="cert-manager CA 集成" class=sidelist><a href=/zh/istio-ca-certs-integrations/cert-manager-integration/>cert-manager CA 集成</a></ul></li><li data-nav-id=/zh/istio-in-practice/ title="Istio 实践教程" class="sidelist parent"><a href=/zh/istio-in-practice/>Istio 实践教程</a><ul><li data-nav-id=/zh/istio-in-practice/prerequisites/ title=先决条件 class=sidelist><a href=/zh/istio-in-practice/prerequisites/>先决条件</a><li data-nav-id=/zh/istio-in-practice/zero-downtime-releases/ title=如何执行零停机时间发布 class=sidelist><a href=/zh/istio-in-practice/zero-downtime-releases/>如何执行零停机时间发布</a><li data-nav-id=/zh/istio-in-practice/traffic-mirroring/ title=如何使用流量镜像 class=sidelist><a href=/zh/istio-in-practice/traffic-mirroring/>如何使用流量镜像</a><li data-nav-id=/zh/istio-in-practice/sticky-sessions/ title=如何使用粘性会话 class=sidelist><a href=/zh/istio-in-practice/sticky-sessions/>如何使用粘性会话</a><li data-nav-id=/zh/istio-in-practice/setting-up-ssl-certs/ title="如何设置 SSL 证书" class="sidelist parent active"><a href=/zh/istio-in-practice/setting-up-ssl-certs/>如何设置 SSL 证书</a><li data-nav-id=/zh/istio-in-practice/multiple-ingress-gateways/ title="如何部署多个 Istio 入口网关" class=sidelist><a href=/zh/istio-in-practice/multiple-ingress-gateways/>如何部署多个 Istio 入口网关</a><li data-nav-id=/zh/istio-in-practice/aws-cloudmap-integration/ title="将 AWS Cloud Map 与 Istio 集成" class=sidelist><a href=/zh/istio-in-practice/aws-cloudmap-integration/>将 AWS Cloud Map 与 Istio 集成</a><li data-nav-id=/zh/istio-in-practice/install-skywalking/ title="集成 Apache SkyWalking" class=sidelist><a href=/zh/istio-in-practice/install-skywalking/>集成 Apache SkyWalking</a></ul></li><li data-nav-id=/zh/ecosystem-partners/ title="生态 & 合作伙伴" class=sidelist><a href=/zh/ecosystem-partners/>生态 & 合作伙伴</a><ul><li data-nav-id=/zh/ecosystem-partners/appviewx/ title=AppViewX class=sidelist><a href=/zh/ecosystem-partners/appviewx/>AppViewX</a><li data-nav-id=/zh/ecosystem-partners/jetstack/ title=Jetstack class=sidelist><a href=/zh/ecosystem-partners/jetstack/>Jetstack</a><ul><li data-nav-id=/zh/ecosystem-partners/jetstack/cert-manager/ title="Cert Manager" class=sidelist><a href=/zh/ecosystem-partners/jetstack/cert-manager/>Cert Manager</a></ul></li><li data-nav-id=/zh/ecosystem-partners/keyfactor/ title=Keyfactor class=sidelist><a href=/zh/ecosystem-partners/keyfactor/>Keyfactor</a><li data-nav-id=/zh/ecosystem-partners/weaveworks/ title=Weaveworks class=sidelist><a href=/zh/ecosystem-partners/weaveworks/>Weaveworks</a></ul></li><li data-nav-id=/zh/istio-cheatsheet/ title="Istio 速查表" class=sidelist><a href=/zh/istio-cheatsheet/>Istio 速查表</a><ul><li data-nav-id=/zh/istio-cheatsheet/cheatsheet/ title class=sidelist><a href=/zh/istio-cheatsheet/cheatsheet/></a></ul></li><li data-nav-id=/zh/faq/ title=FAQ class=sidelist><a href=/zh/faq/>FAQ</a><ul><li data-nav-id=/zh/faq/faqs/ title class=sidelist><a href=/zh/faq/faqs/></a></ul></li><li data-nav-id=/zh/community/ title=社区 class=sidelist><a href=/zh/community/>社区</a><ul><li data-nav-id=/zh/community/event/ title=活动 class=sidelist><a href=/zh/community/event/>活动</a><ul><li data-nav-id=/zh/community/event/getistio-inaugural/ title="00: GetIstio 介绍——社区开幕 meetup" class=sidelist><a href=/zh/community/event/getistio-inaugural/>00: GetIstio 介绍——社区开幕 meetup</a><li data-nav-id=/zh/community/event/istiocon-2021/ title="IstioCon 2021" class=sidelist><a href=/zh/community/event/istiocon-2021/>IstioCon 2021</a><li data-nav-id=/zh/community/event/getenvoy-deep-dive/ title="01：使用 GetEnvoy 轻松实现 Envoy 和 WASM" class=sidelist><a href=/zh/community/event/getenvoy-deep-dive/>01：使用 GetEnvoy 轻松实现 Envoy 和 WASM</a><li data-nav-id=/zh/community/event/getistio-deep-dive/ title="02：使用 GetIstio 轻松管理 Istio" class=sidelist><a href=/zh/community/event/getistio-deep-dive/>02：使用 GetIstio 轻松管理 Istio</a><li data-nav-id=/zh/community/event/istio-big-talk-ep-01/ title="《Istio 大咖说》第 1 期：Istio 开源四周年回顾与展望" class=sidelist><a href=/zh/community/event/istio-big-talk-ep-01/>《Istio 大咖说》第 1 期：Istio 开源四周年回顾与展望</a><li data-nav-id=/zh/community/event/istio-big-talk-ep-02/ title="《Istio 大咖说》第 2 期：从微服务架构到 Istio——架构升级实践分享" class=sidelist><a href=/zh/community/event/istio-big-talk-ep-02/>《Istio 大咖说》第 2 期：从微服务架构到 Istio——架构升级实践分享</a><li data-nav-id=/zh/community/event/istio-big-talk-ep-03/ title="《Istio 大咖说》第 3 期：如何让 Istio 变得更为高效和智能" class=sidelist><a href=/zh/community/event/istio-big-talk-ep-03/>《Istio 大咖说》第 3 期：如何让 Istio 变得更为高效和智能</a><li data-nav-id=/zh/community/event/istio-big-talk-ep-04/ title="《Istio 大咖说》第 4 期：如何让 Istio 在大规模生产中落地" class=sidelist><a href=/zh/community/event/istio-big-talk-ep-04/>《Istio 大咖说》第 4 期：如何让 Istio 在大规模生产中落地</a><li data-nav-id=/zh/community/event/istio-big-talk-ep-05/ title="《Istio 大咖说》第 5 期：腾讯云服务网格生产落地最佳实践" class=sidelist><a href=/zh/community/event/istio-big-talk-ep-05/>《Istio 大咖说》第 5 期：腾讯云服务网格生产落地最佳实践</a><li data-nav-id=/zh/community/event/istio-big-talk-ep-06/ title="《Istio 大咖说》第 6 期：Envoy Proxy 在线答疑" class=sidelist><a href=/zh/community/event/istio-big-talk-ep-06/>《Istio 大咖说》第 6 期：Envoy Proxy 在线答疑</a><li data-nav-id=/zh/community/event/istio-big-talk-ep-07/ title="《Istio 大咖说》第 7 期：基于 Envoy/Istio 的云原生 API 网关 —— 开源项目 Hango 的设计与实现" class=sidelist><a href=/zh/community/event/istio-big-talk-ep-07/>《Istio 大咖说》第 7 期：基于 Envoy/Istio 的云原生 API 网关 —— 开源项目 Hango 的设计与实现</a></ul></li><li data-nav-id=/community/building-and-testing/ title="Building and Testing" class=sidelist><a href=/community/building-and-testing/>Building and Testing</a><li data-nav-id=/community/contributing/ title="Contributing to GetMesh" class=sidelist><a href=/community/contributing/>Contributing to GetMesh</a><li data-nav-id=/community/release/ title="Release process" class=sidelist><a href=/community/release/>Release process</a></ul></li><li data-nav-id=/zh/download/ title=下载 class=sidelist><a href=/zh/download/>下载</a><ul><li data-nav-id=/zh/download/downloads/ title class=sidelist><a href=/zh/download/downloads/></a></ul></li></ul></div><div class=col-lg-9><div class="px-lg-5 px-4"><h1 class="mb-4 font-weight-medium">如何设置 SSL 证书</h1><div class=content><p>目前，必须使用 SSL 证书。它们通过加密来帮助保护服务器和客户端之间发送的数据，从而使您的网站更具信誉。本节将探讨几种不同的方法来获取 SSL 证书并将<a href=https://istio.io/latest/docs/reference/config/networking/gateway/>Istio 网关</a>配置为使用它们。</p><p>我们将学习如何手动创建自签名证书，然后获取真实的 SSL 证书并进行设置。正如您将看到的，设置所有这些并不太复杂。</p><h2 id=先决条件>先决条件</h2><p>为了继续学习，您将需要一个实际的，由云托管的 Kubernetes 集群。需要一个云托管群集，因为我们需要一个外部 IP 地址来连接域名。当然，您还需要一个域名。</p><p>您可以按照<a href=../prerequisites>先决条件</a>获取有关如何安装和设置 Istio 的说明。</p><h2 id=部署样本应用程序>部署样本应用程序</h2><p>为了确保所有内容都能正常工作，我们将首先部署一个简单的 Hello World Web 应用程序。如果您要使用自己的应用程序 / 服务，请随时使用。否则，您可以继续使用并使用该 <code>gcr.io/tetratelabs/hello-world:1.0.0</code> 镜像。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl create deploy helloworld --image<span style=color:#719e07>=</span>gcr.io/tetratelabs/hello-world:1.0.0 --port<span style=color:#719e07>=</span><span style=color:#2aa198>3000</span>
</code></pre></div><p>接下来，让我们为其创建一个 Kubernetes 服务。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2>apiVersion</span>: v1
<span style=color:#268bd2>kind</span>: Service
<span style=color:#268bd2>metadata</span>:
  <span style=color:#268bd2>name</span>: helloworld
  <span style=color:#268bd2>labels</span>:
    <span style=color:#268bd2>app</span>: helloworld
<span style=color:#268bd2>spec</span>:
  <span style=color:#268bd2>ports</span>:
  - <span style=color:#268bd2>name</span>: http
    <span style=color:#268bd2>port</span>: <span style=color:#2aa198>80</span>
    <span style=color:#268bd2>targetPort</span>: <span style=color:#2aa198>3000</span>
  <span style=color:#268bd2>selector</span>:
    <span style=color:#268bd2>app</span>: helloworld
</code></pre></div><p>将上述 YAML 复制到<code>helloworld-svc.yaml</code>并使用进行部署<code>kubectl apply -f helloworld-svc.yaml</code>。</p><blockquote><p>请注意，我们没有使用<code>kubectl expose</code>命令，因为我们需要在 Kubernetes 服务（例如<code>http</code>）中命名端口，而我们不能通过暴露命令来做到这一点。</p></blockquote><p>要从外部 IP 访问服务，我们还需要一个网关资源：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2>apiVersion</span>: networking.istio.io/v1alpha3
<span style=color:#268bd2>kind</span>: Gateway
<span style=color:#268bd2>metadata</span>:
  <span style=color:#268bd2>name</span>: public-gateway
<span style=color:#268bd2>spec</span>:
  <span style=color:#268bd2>selector</span>:
    <span style=color:#268bd2>istio</span>: ingressgateway
  <span style=color:#268bd2>servers</span>:
    - <span style=color:#268bd2>port</span>:
        <span style=color:#268bd2>number</span>: <span style=color:#2aa198>80</span>
        <span style=color:#268bd2>name</span>: http
        <span style=color:#268bd2>protocol</span>: HTTP
      <span style=color:#268bd2>hosts</span>:
        - <span style=color:#2aa198>&#39;*&#39;</span>
</code></pre></div><p>将上述 YAML 保存到<code>gateway.yaml</code>并使用进行部署<code>kubectl apply -f gateway.yaml</code>。</p><blockquote><p>注意：该<code>hosts</code>字段的值为<code>*</code>。在为域名创建 SSL 证书后，我们将更改此字段的值。该值将是实际的域名。</p></blockquote><p>最后，我们还需要一个 VirtualService，将流量路由到 <code>helloworld</code> Kubernetes 服务：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2>apiVersion</span>: networking.istio.io/v1alpha3
<span style=color:#268bd2>kind</span>: VirtualService
<span style=color:#268bd2>metadata</span>:
  <span style=color:#268bd2>name</span>: helloworld
<span style=color:#268bd2>spec</span>:
  <span style=color:#268bd2>hosts</span>:
    - <span style=color:#2aa198>&#39;*&#39;</span>
  <span style=color:#268bd2>gateways</span>:
    - public-gateway
  <span style=color:#268bd2>http</span>:
    - <span style=color:#268bd2>route</span>:
      - <span style=color:#268bd2>destination</span>:
          <span style=color:#268bd2>host</span>: helloworld.default.svc.cluster.local
          <span style=color:#268bd2>port</span>:
            <span style=color:#268bd2>number</span>: <span style=color:#2aa198>80</span>
</code></pre></div><p>将上述 YAML 保存到<code>helloworld-vs.yaml</code>并使用进行部署<code>kubectl apply -f helloworld-vs.yaml</code>。</p><p>部署了所有这些资源后，您现在可以获取 Istio 入口网关的外部 IP：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl get svc -l <span style=color:#268bd2>istio</span><span style=color:#719e07>=</span>ingressgateway -n istio-system
</code></pre></div><p>如果打开<code>EXTERNAL-IP</code>列中显示的 IP ，您将看到与下图相似的内容。</p><p><img src=not-secure.png alt="Connection is not secure"></p><p>我们从应用程序中获得了响应，但也<code>Not Secure</code>从浏览器中获得了消息，该消息告诉用户连接不安全，也没有给人很大的信心。</p><h2 id=自签名证书和手动设置>自签名证书和手动设置</h2><p>让我们从最简单的场景开始，我们手动获得证书。首先 - 选择您要使用的域 - 请注意，要进行测试，您不必拥有实际的域名，因为我们将使用自签名证书。</p><blockquote><p>自签名证书未由证书颁发机构（CA）签名。您将使用这些证书进行开发和测试。但是，它们不提供由 CA 签名的证书提供的所有安全功能。</p></blockquote><p>我将使用<code>mysuperdomain.com</code>我的域名。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#b58900>export</span> <span style=color:#268bd2>DOMAIN_NAME</span><span style=color:#719e07>=</span>mysuperdomain.com
</code></pre></div><p>第一步，我们将创建根证书（<code>$DOMAIN_NAME.crt</code>）和用于对证书进行签名的私钥（<code>$DOMAIN_NAME.key</code>）：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>openssl req -x509 -sha256 -nodes -days <span style=color:#2aa198>365</span> -newkey rsa:2048 -subj <span style=color:#2aa198>&#39;/O=$DOMAIN_NAME Inc./CN=$DOMAIN_NAME&#39;</span> -keyout <span style=color:#268bd2>$DOMAIN_NAME</span>.key -out <span style=color:#268bd2>$DOMAIN_NAME</span>.crt
</code></pre></div><p>上面的命令创建一个<code>.crt</code>和<code>.key</code>文件。</p><p>接下来，我们需要创建私钥和签名请求：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>openssl req -out helloworld.<span style=color:#268bd2>$DOMAIN_NAME</span>.csr -newkey rsa:2048 -nodes -keyout helloworld.<span style=color:#268bd2>$DOMAIN_NAME</span>.key -subj <span style=color:#2aa198>&#34;/CN=helloworld.</span><span style=color:#268bd2>$DOMAIN_NAME</span><span style=color:#2aa198>/O=hello world from </span><span style=color:#268bd2>$DOMAIN_NAME</span><span style=color:#2aa198>&#34;</span>
</code></pre></div><p>最后，我们可以创建证书：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>openssl x509 -req -days <span style=color:#2aa198>365</span> -CA <span style=color:#268bd2>$DOMAIN_NAME</span>.crt -CAkey <span style=color:#268bd2>$DOMAIN_NAME</span>.key -set_serial <span style=color:#2aa198>0</span> -in helloworld.<span style=color:#268bd2>$DOMAIN_NAME</span>.csr -out helloworld.<span style=color:#268bd2>$DOMAIN_NAME</span>.crt
</code></pre></div><p>现在您已经有了证书和密钥，您可以创建 Kubernetes Secret 来存储证书和密钥。</p><p>必须调用带有证书的 secret，<code>istio-ingressgateway-certs,</code>我们必须将其部署到<code>istio-system</code> 命名空间。这样，Istio 入口网关将自动加载 secret。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl create secret tls istio-ingressgateway-certs -n istio-system --key helloworld.<span style=color:#268bd2>$DOMAIN_NAME</span>.key --cert helloworld.<span style=color:#268bd2>$DOMAIN_NAME</span>.crt
</code></pre></div><p>设置好 secret 之后，让我们更新网关资源，并告诉它使用此证书和私钥：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cat <span style=color:#2aa198>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#2aa198>apiVersion: networking.istio.io/v1alpha3
</span><span style=color:#2aa198>kind: Gateway
</span><span style=color:#2aa198>metadata:
</span><span style=color:#2aa198>  name: public-gateway
</span><span style=color:#2aa198>spec:
</span><span style=color:#2aa198>  selector:
</span><span style=color:#2aa198>    istio: ingressgateway
</span><span style=color:#2aa198>  servers:
</span><span style=color:#2aa198>  - port:
</span><span style=color:#2aa198>      number: 443
</span><span style=color:#2aa198>      name: https
</span><span style=color:#2aa198>      protocol: HTTPS
</span><span style=color:#2aa198>    tls:
</span><span style=color:#2aa198>      mode: SIMPLE
</span><span style=color:#2aa198>      # These are coming from the istio-ingressgateway-certs secret
</span><span style=color:#2aa198>      serverCertificate: /etc/istio/ingressgateway-certs/tls.crt
</span><span style=color:#2aa198>      privateKey: /etc/istio/ingressgateway-certs/tls.key
</span><span style=color:#2aa198>    hosts:
</span><span style=color:#2aa198>    - helloworld.$DOMAIN_NAME
</span><span style=color:#2aa198>EOF</span>
</code></pre></div><p>同样，我们需要使用设置为<code>$DOMAIN_NAME</code>环境变量的域名来更新 VirtualService 中的 hosts 字段：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cat <span style=color:#2aa198>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#2aa198>apiVersion: networking.istio.io/v1alpha3
</span><span style=color:#2aa198>kind: VirtualService
</span><span style=color:#2aa198>metadata:
</span><span style=color:#2aa198>  name: helloworld
</span><span style=color:#2aa198>spec:
</span><span style=color:#2aa198>  hosts:
</span><span style=color:#2aa198>    - helloworld.$DOMAIN_NAME
</span><span style=color:#2aa198>  gateways:
</span><span style=color:#2aa198>    - public-gateway
</span><span style=color:#2aa198>  http:
</span><span style=color:#2aa198>    - route:
</span><span style=color:#2aa198>      - destination:
</span><span style=color:#2aa198>          host: helloworld.default.svc.cluster.local
</span><span style=color:#2aa198>          port:
</span><span style=color:#2aa198>            number: 80
</span><span style=color:#2aa198>EOF</span>
</code></pre></div><p>测试此功能最简单的方法是使用 cURL 和该<code>--resolve</code>标志。</p><p>resolve 标志的格式为<code>[DOMAIN]:[PORT]:[IP]</code>，它将与该<code>[DOMAIN]:[PORT]</code>部分匹配的所有请求路由到指定的 IP 地址。这样，我们无需访问 DNS / 域注册商的网站并进行更改即可对其进行测试，并且我们可以使用一个甚至不存在的域。</p><p>本例中的 IP 地址是入口网关的外部 IP 地址。让我们将网关的 IP 地址保存到<code>EXTERNAL_IP</code>环境变量中：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#b58900>export</span> <span style=color:#268bd2>EXTERNAL_IP</span><span style=color:#719e07>=</span><span style=color:#719e07>$(</span>kubectl get svc istio-ingressgateway -n istio-system -o <span style=color:#268bd2>jsonpath</span><span style=color:#719e07>=</span><span style=color:#2aa198>&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span style=color:#719e07>)</span>
</code></pre></div><p>最后，让我们使用此 cURL 命令来测试 SSL 证书是否得到验证和使用：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>curl -v --resolve helloworld.<span style=color:#268bd2>$DOMAIN_NAME</span>:443:<span style=color:#268bd2>$EXTERNAL_IP</span> --cacert <span style=color:#268bd2>$DOMAIN_NAME</span>.crt https://helloworld.<span style=color:#268bd2>$DOMAIN_NAME</span>
</code></pre></div><p>我们告诉 cURL<code>helloworld.mysuperdomain.com:443</code>使用上述命令将对入站网关的外部 IP 地址的所有请求解析为。此外，我们提供了先前创建的 CA 证书的名称。</p><p>从输出中，您将能够看到服务器证书的详细信息以及显示该证书已验证的行以及<code>helloworld</code>Pod 的实际响应：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>...
* Server certificate:
*  subject: CN=helloworld.mysuperdomain.com; O=hello world from mysuperdomain.com
*  start date: Feb 2 23:32:11 2021 GMT
*  expire date: Feb 2 23:32:11 2022 GMT
*  common name: helloworld.mysuperdomain.com (matched)
*  issuer: O=mysuperdomain.com Inc.; CN=mysuperdomain.com
*  SSL certificate verify ok.
...
Hello World
</code></pre></div><h2 id=真实签名的证书和手动设置>真实签名的证书和手动设置</h2><p>上一节中的自签名证书路径对于踢轮胎和测试事物很有用。我们将需要由您的客户可以信任的真实证书颁发机构（CA）签名的证书。</p><p>有两种方法可以获取 SSL 证书。最受欢迎的是<a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a>。我们将使用<a href=https://www.sslforfree.com/>SSL For Free</a>，它使用 Let&rsquo;s Encrypt 颁发证书。如果您想花钱，还可以从域注册商或<a href=https://digicert.com/>DigiCert</a>购买 SSL 证书。</p><p>在本节中，我们将使用真实的域名和实际的 SSL 证书——这意味着，如果您想继续学习，请确保已准备好要使用的域。</p><p>注册域后，<a href=https://sslforfree.com/>免费</a>打开 <a href=https://sslforfree.com/>SSL</a> 以获取 SSL 证书。请注意，您将必须注册一个免费帐户才能创建 SSL 证书。</p><ol><li>输入您的域名，例如<code>mydomain.com</code>在文本字段中。</li><li>单击创建免费 SSL 证书按钮。</li><li>在仪表板上，单击 “**New Certificate”**按钮。</li></ol><p><img src=new-cert.png alt="New Certificate"></p><ol><li>输入域名，然后单击<strong>下一步</strong>按钮。</li><li>选择 90 天证书选项，然后单击下一步。</li><li>确认自动生成 CSR 选项，然后单击 “下一步”。</li><li>在最后一页上，选择 “**免费”**选项，然后单击 “下一步”。</li></ol><p>创建证书后，我们将需要验证域名并证明我们拥有为其创建 SSL 证书的域名。</p><p>可以使用三个选项来验证域：电子邮件验证（确保在域上设置了电子邮件），DNS（CNAME）验证和 HTTP 文件上传。</p><p><img src=install-cert.png alt="Install Certificate"></p><p>您可以使用这些选项中的任何一个。我将使用 CNAME 验证。CNAME 验证涉及登录到您的域注册商，并设置具有特定值的 CNAME 记录。</p><h3 id=设置姓名记录>设置姓名记录</h3><p>登录到域名注册商的网站后，我们还要为该域创建一个 A 记录，该记录将指向您的群集的外部 IP 地址。</p><p>由于我们请求 mydomain.com 和<a href=http://www.mydomain.com/>www.mydomain.com</a>的证书，因此 A 记录应指向<code>mydomain.com</code>IP 地址。</p><h3 id=验证域>验证域</h3><p>设置 A 记录和 CNAME 之后，可以单击 “**验证域”**按钮。请注意，值传播和验证域可能需要一些时间。</p><p>验证域后，将颁发证书，您将能够下载包含生成文件的 ZIP 包。</p><p>该软件包将包含以下文件：</p><ul><li>ca_bundle.crt</li><li>certificate.crt</li><li>私钥</li></ul><h3 id=重新创建秘密>重新创建秘密</h3><p>让我们删除现有<code>ingressgateway-certs</code>机密，并使用真实证书创建一个新机密：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl delete secret istio-ingressgateway-certs -n istio-system
</code></pre></div><p>我们可以使用从下载的软件包中获得的真实 SSL 证书和密钥来重新创建 Secret：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl create secret tls istio-ingressgateway-certs -n istio-system --key private.key --cert certificate.crt
</code></pre></div><p>我们还需要更新网关和 VirtualService 来修改主机名。</p><p>让我们先更新网关（确保将其更新<code>mysuperdomain.com</code>为您的实际域名）：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cat <span style=color:#2aa198>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#2aa198>apiVersion: networking.istio.io/v1alpha3
</span><span style=color:#2aa198>kind: Gateway
</span><span style=color:#2aa198>metadata:
</span><span style=color:#2aa198>  name: public-gateway
</span><span style=color:#2aa198>spec:
</span><span style=color:#2aa198>  selector:
</span><span style=color:#2aa198>    istio: ingressgateway
</span><span style=color:#2aa198>  servers:
</span><span style=color:#2aa198>  - port:
</span><span style=color:#2aa198>      number: 443
</span><span style=color:#2aa198>      name: https
</span><span style=color:#2aa198>      protocol: HTTPS
</span><span style=color:#2aa198>    tls:
</span><span style=color:#2aa198>      mode: SIMPLE
</span><span style=color:#2aa198>      # These are coming from the istio-ingressgateway-certs secret
</span><span style=color:#2aa198>      serverCertificate: /etc/istio/ingressgateway-certs/tls.crt
</span><span style=color:#2aa198>      privateKey: /etc/istio/ingressgateway-certs/tls.key
</span><span style=color:#2aa198>    hosts:
</span><span style=color:#2aa198>    - mysuperdomain.com
</span><span style=color:#2aa198>EOF</span>
</code></pre></div><p>同样，对 VirtualService 进行更改：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cat <span style=color:#2aa198>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#2aa198>apiVersion: networking.istio.io/v1alpha3
</span><span style=color:#2aa198>kind: VirtualService
</span><span style=color:#2aa198>metadata:
</span><span style=color:#2aa198>  name: helloworld
</span><span style=color:#2aa198>spec:
</span><span style=color:#2aa198>  hosts:
</span><span style=color:#2aa198>    - mysuperdomain.com
</span><span style=color:#2aa198>  gateways:
</span><span style=color:#2aa198>    - public-gateway
</span><span style=color:#2aa198>  http:
</span><span style=color:#2aa198>    - route:
</span><span style=color:#2aa198>      - destination:
</span><span style=color:#2aa198>          host: helloworld.default.svc.cluster.local
</span><span style=color:#2aa198>          port:
</span><span style=color:#2aa198>            number: 80
</span><span style=color:#2aa198>EOF</span>
</code></pre></div><p>随着这两个资源的更新，您可以打开所选的浏览器并导航到域。您应该<code>Hello World!</code>在域名显示网站安全之前看到响应和挂锁。如果单击挂锁并检查证书，您将在证书中看到您的域名，以及根授权（Let&rsquo;s Encrypt）和到期日期。</p></div><nav class=pagination><a class="nav nav-prev" href=/zh/istio-in-practice/sticky-sessions/><i class="ti-arrow-left mr-2"></i>
<span class="d-none d-md-block">如何使用粘性会话</span></a>
<a class="nav nav-next" href=/zh/istio-in-practice/multiple-ingress-gateways/><span class="d-none d-md-block">如何部署多个 Istio 入口网关</span><i class="ti-arrow-right ml-2"></i></a></nav></div></div></div></div></section><footer><div class=container><div class="row align-items-center pb-0 footer-logo"><a class=navbar-brand href=/zh><img id=getistio-footer-logo class=img-fluid src=/images/tetrate-istio-distro-logo.png alt="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"></a>
<a href=https://www.tetrate.io target=_blank><img id=tetrate-footer-logo class=img-fluid src=/images/tetrate-logo.svg alt="Tetrate Logo"></a></div><div class="py-4 text-center"><div class=mb-4><ul class="list-inline social-icons text-lg-center text-center"><li class=list-inline-item><a href=https://www.tetrate.io/ target=_blank aria-label="Tetrate website"><i class=ti-world></i></a></li><li class=list-inline-item><a href=https://www.twitter.com/tetrateio target=_blank aria-label="Tetrate Twitter account"><i class=ti-twitter-alt></i></a></li><li class=list-inline-item><a href=https://www.github.com/tetratelabs target=_blank aria-label="Tetrate Github account"><i class=ti-github></i></a></li><li class=list-inline-item><a href=https://www.linkedin.com/company/tetrate/ target=_blank aria-label="Tetrate LinkedIn account"><i class=ti-linkedin></i></a></li></ul></div><small class=text-white>Support: Join our <a href=https://tetr8.io/tetrate-community target=_blank>#tid-and-getmesh Slack Channel</a> for Community Support</small><br><small class=text-white>License: Tetrate Istio Distro is an open source project and is released under Apache License 2.0 | <a href=https://www.tetrate.io/privacy target=_blank>Privacy Statement</a></small><br><small class=text-white>Official project site of istio is <a href=https://www.istio.io target=_blank>istio.io</a></small><br><small class=text-white>Copyright &copy; 2023 <a href=https://www.tetrate.io target=_blank>Tetrate</a> All rights reserved.</small></div></div></footer><script type=text/javascript>var indexURL="/index.json",baseurl="https://istio.tetratelabs.io//zh"</script><script src=/plugins/jQuery/jquery.min.js></script><script src=/plugins/bootstrap/bootstrap.min.js></script><script src=/plugins/featherlight/featherlight.min.js></script><script src=/plugins/clipboard/clipboard.min.js></script><script src=/plugins/match-height/jquery.matchHeight-min.js></script><script src=/plugins/search/auto-complete.js></script><script src=/plugins/search/search.js></script><script src=/plugins/search/lunr.min.js></script><script src=/plugins/search/fuse.min.js></script><script src=/plugins/search/mark.js></script><script src=/plugins/search/search-page.js></script><script src=/js/script.min.js></script><script src=/js/form.min.js></script><script type=text/javascript src="//js.hsforms.net/forms/v2.js?pre=1"></script><script async defer src=https://buttons.github.io/buttons.js></script></body></html>