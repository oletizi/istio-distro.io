<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title itemprop=name>网易轻舟如何基于 Istio 实现微服务架构演进 | 简单、安全的企业级 Istio 发行版 | GetIstio 由 Tetrate 出品</title><meta name=twitter:title content="网易轻舟如何基于 Istio 实现微服务架构演进 | 简单、安全的企业级 Istio 发行版 | GetIstio 由 Tetrate 出品"><meta itemprop=name content="网易轻舟如何基于 Istio 实现微服务架构演进 | 简单、安全的企业级 Istio 发行版 | GetIstio 由 Tetrate 出品"><meta name=application-name content="网易轻舟如何基于 Istio 实现微服务架构演进 | 简单、安全的企业级 Istio 发行版 | GetIstio 由 Tetrate 出品"><meta property="og:site_name" content="Tetrate Istio Distro"><meta name=description content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta itemprop=description content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta name=twitter:description content="Tetrate Istio Distro project provides a simple, safe, enterprise-grade Istio distro."><meta property="og:locale" content="zh"><meta name=language content="中文"><link rel=alternate hreflang=en href=/blog/netease-qingzhou-istio-practice/><link rel=alternate hreflang=zh href=/zh/blog/netease-qingzhou-istio-practice/><meta property="og:updated_time" content="2020-02-02T00:00:00Z"><link rel=sitemap type=application/xml title=Sitemap href=/sitemap.xml><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="2020-02-02T00:00:00Z"><meta property="article:published_time" content="2020-02-02T00:00:00Z"><meta property="og:article:author" content="[裴斐](Https www.linkedin.com in 斐 裴 0a182099)"><meta property="article:author" content="[裴斐](Https www.linkedin.com in 斐 裴 0a182099)"><meta name=author content="[裴斐](Https www.linkedin.com in 斐 裴 0a182099)"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"网易轻舟如何基于 Istio 实现微服务架构演进","author":{"@type":"Person","name":"https:\/\/github.com\/tetratelabs\/getmesh"},"datePublished":"2020-02-02","description":"网易轻舟使用 Istio 的实践分享。","wordCount":2224,"mainEntityOfPage":"True","dateModified":"2020-02-02","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"Tetrate Istio Distro | Simple, safe enterprise-grade Istio","logo":{"@type":"imageObject","url":"https://getistio.io/images/getistio-by-tetrate-logo.png"}}}</script><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content="@tetrateio"><meta name=twitter:creator content="@tetrateio"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><meta name=generator content="Hugo 0.85.0"><script async src="https://www.googletagmanager.com/gtag/js?id=G-P3J9XNBME4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-P3J9XNBME4')</script><link rel=preload href=/plugins/themify-icons/themify-icons.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/plugins/themify-icons/themify-icons.css></noscript><link rel=preload href=/plugins/search/auto-complete.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/plugins/search/auto-complete.css></noscript><link rel=preload href=/plugins/featherlight/featherlight.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/plugins/featherlight/featherlight.min.css></noscript><link rel=preload href=/css/bootstrap/bootstrap.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css></noscript><link rel=preload href=/scss/style.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=/scss/style.css></noscript><link rel="shortcut icon" href=/images/getistio-favicon.png type=image/x-icon><link rel=icon href=/images/getistio-favicon.png type=image/x-icon><meta property="og:title" content="网易轻舟如何基于 Istio 实现微服务架构演进"><meta property="og:description" content="网易轻舟使用 Istio 的实践分享。"><meta property="og:type" content="article"><meta property="og:url" content="https://istio.tetratelabs.io/zh/blog/netease-qingzhou-istio-practice/"><meta property="og:image" content="https://istio.tetratelabs.io/images/twitter-card-new.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-02-02T00:00:00+00:00"><meta property="article:modified_time" content="2020-02-02T00:00:00+00:00"><script async defer src=/js/turbolinks.min.js></script></head><body><header class="sticky-top navigation"><div class=my-container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><div class=navbar-brand-container><a class=navbar-brand href=/zh><img class="img-fluid logo-width" src=/images/tetrate-istio-distro-logo.png alt="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"></a>
<a class=github-button href=https://github.com/tetratelabs/getistio data-icon=octicon-star aria-label="Star tetratelabs/getmesh on GitHub">Star</a></div><button aria-label=Menu class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h4 text-white"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav mx-auto align-items-center"><li class=nav-item><a class=nav-link href=/zh/getmesh-cli/>文档</a></li><li class=nav-item><a class=nav-link href=/zh/blog/>博客</a></li><li class=nav-item><a class=nav-link href=/zh/community-events/>社区</a></li><li class=nav-item><a class=nav-link href=https://academy.tetrate.io target=_blank>培训</a></li><li class=nav-item><a class=nav-link href=https://func-e.io/ target=_blank>func-e</a></li><li class=nav-item><a class=nav-link href=https://www.istio.io/ target=_blank>Istio.io</a></li><li class=nav-link><select class=nav-item id=select-language onchange="location=this.value"><option id=en value=/blog/netease-qingzhou-istio-practice/>En</option><option id=zh value=/zh/blog/netease-qingzhou-istio-practice/ selected>中文</option></select></li></ul><div class="d-lg-none d-block"><a href=/zh/download class="btn btn-sm btn-primary ml-lg-4">download</a></div></div><div class="d-lg-flex d-none"><a href=/zh/download class="btn btn-sm btn-primary ml-lg-4">下载</a></div></nav></div></header><section class="py-5 blog-individual"><div class=container><div class="row mt-0 mb-0 justify-content-center"><div class=col-12><a href=../ class=link-grey>← 返回博客列表</a><hr></div><div class="col-sm-9 mt-3"><h1>网易轻舟如何基于 Istio 实现微服务架构演进</h1><p class="blog-date mt-3"><span class=author-info>作者 <a href=https://www.linkedin.com/in/%E6%96%90-%E8%A3%B4-0a182099>裴斐</a></span>
<span>发布于 2020年2月2日</span>
/ 10 分钟阅读</p><div class="article-tags mb-4"><span class="mr-3 single-tag"><a href=https://istio.tetratelabs.io/zh/tags/%E6%A1%88%E4%BE%8B%E5%88%86%E4%BA%AB/>案例分享</a></span></div></div></div><div class="row justify-content-center mt-0 blog-content"><div class=col-sm-9><p>作者：裴斐，网易轻舟高级架构师。</p><h3 id=problem>Problem</h3><p>网易作为一家拥有众多互联网业务的公司，不同业务结合自身的业务特性、团队组成均有一些微服务技术栈选择、体系建设，这在业务发展初期并没有问题。当业务持续发展，不管业务规模、复杂度、团队的组成都发生了变化，这时候微服务架构就会遇到诸多问题：</p><ul><li>各业务分别投入研发，研发成本高</li><li>网易集团技术资产无法沉淀</li><li>微服务框架对业务侵入性大，需要业务人员明显感知、学习、掌控和维护</li><li>升级周期长，即使是很小版本的框架升级，都需要动辄1个月以上的升级周期</li><li>语言局限，绝大多数核心业务的微服务体系基于Java语言构建，对其他语言支持薄弱</li></ul><h3 id=strategy>Strategy</h3><p>Service Mesh是云原生体系下重要的微服务技术，可以有效的解决网易诸多互联网业务在微服务架构下存在的问题。网易选择Istio这一有代表性的Service Mesh开源框架有着深刻的考虑：</p><ul><li>有深厚的云原生背景及大厂背书</li><li>Istio的核心数据面组件Envoy是云原生数据面的事实标准组件</li><li>在Service Mesh领域，Istio是最为流行的框架选择，有着活跃的技术社区和优秀的技术架构</li><li>Istio在帮助企业落地、框架易用性方面持续优化，具备企业应用的亲和性</li></ul><p>在确定Istio为Service Mesh框架选型后，网易数帆的轻舟团队构建了轻舟Service Mesh平台，以解决网易集团诸多互联网业务面临的微服务架构问题，并整合已有的微服务治理框架，形成支撑通用分布式、微服务架构演进的微服务平台，赋能更多企业的微服务架构演进与升级。此外，网易轻舟还基于Istio技术栈实现了API网关体系升级，基于Envoy与Isito的轻舟API网关能力更丰富，性能更好，已成为网易API网关的标准组件。</p><p>尽管Istio提供了非常完整的Service Mesh解决方案，企业在构建Service Mesh体系时仍需要明晰的建设路线。
<img src=008eGmZEly1gn9clbh23vj30ye0ow4b3.jpg alt="Service Mesh建设路线"></p><h5 id=架构设计>架构设计</h5><p>网易轻舟Service Mesh整体架构如下。</p><p><img src=008eGmZEly1gna7mmf7otj311s0u0wk1.jpg alt="网易轻舟 Service Mesh 整体架构"></p><p><strong>架构设计要点</strong>：</p><ul><li>通过<strong>扩展Envoy+定制Istio</strong>进行了整体的架构设计，并进行相应的可行性验证。</li><li><strong>以Envoy为核心的数据面，支持多种拦截方式</strong>。除原生Istio支持的全量拦截TCP流量外，加入了IP指向、动态控制拦截等易于业务接入的流量拦截方式。</li><li><strong>以Istio Pilot为核心的控制面，其他组件可插拔</strong>。Istio 1.5之前版本控制面组件较多，维护成本较高。选定控制面核心组件Pilot为必要组件，其他组件可插拔，不仅降低了Istio生产落地的风险和运维成本，也让研发、维护者在体系构建上更加聚焦。</li><li><strong>多种扩展方式，供业务已有平台快速接入</strong>。提供了原生Istio CRD、MCP、API平面等多种平台开放方式，一方面将原生能力完整保留，另一方面通过简单Restful API方式，降低企业平台构建或已有平台接入成本。</li><li><strong>性能优化</strong>：组件、网络多管齐下。一方面在组件层进行优化，如将Istio早期版本集中式Mixer后端能力下沉到Envoy filter，提供基于调用链路审计的配置瘦身等。另一方面配合容器网络进行网络加速，降低延时。</li></ul><h5 id=演进方案>演进方案</h5><p>基于整体架构设计，结合业务实际的架构、技术栈，形成微服务架构演进方案。以网易电商业务演进方案为例，演进架构图如下：</p><p><img src=008eGmZEly1gn9gb6swd4j30y70u00vq.jpg alt="网易轻舟Service Mesh演进架构"></p><p><strong>演进要点</strong>：</p><ul><li>基于<strong>业务现有技术、架构分析</strong>，形成迁移的整体架构</li><li><strong>业务接入</strong>：在基础设施层进行适配，保障业务无感知迁移</li><li><strong>跨云互访</strong>：基于边缘网关的混合云方案，保障迁移前后环境无缝互访</li><li><strong>高可用保障</strong>：兜底路由、灰度引流等能力建设，保障迁移过程的SLA</li></ul><h5 id=平台建设>平台建设</h5><p>Istio落地过程中，业务需要网格整体视图及快速治理能力，为此我们增强了网易轻舟微服务平台，加入Service Mesh管控能力，支持Service Mesh与微服务框架（Spring Cloud、Dubbo、gRPC、Thrift）跨集群统一管控，帮助用户现有微服务架构平滑迁移。</p><p><img src=008eGmZEly1gn9gb550amj31o20u0jvv.jpg alt="网易轻舟微服务平台支持Service Mesh与微服务框架统一管控">
<img src=008eGmZEly1gn9gb7jd9oj31o20u0gr3.jpg alt="网易轻舟微服务平台支持Service Mesh与微服务框架统一管控"></p><p><strong>建设要点：结合业务痛点，完善产品能力</strong></p><ul><li><strong>可观测性</strong>：提供整体视图及快速治理功能</li><li><strong>易用性</strong>：云原生概念产品级封装</li><li><strong>扩展性</strong>：Open API 体系建设，业务平台快速接入</li></ul><h5 id=体系建设>体系建设</h5><p>基于Istio的Service Mesh技术架构需要完整的体系保障。</p><p><strong>体系建设要点</strong>：
<strong>构建、部署体系</strong>：Service Mesh组件CICD、自动部署
<strong>质量体系</strong>：自动化功能、性能、稳定性测试；整体故障测试；混沌测试
<strong>排障体系</strong>：业务、组件排障，快速对Service Mesh体系的故障定位与恢复
<strong>运维保障体系</strong>：立体化监控、报警
<strong>热升级体系</strong>：支持Sidecar热升
<strong>开源技术体系</strong>：轻舟团队对Service Mesh社区持续贡献</p><h5 id=场景扩展支撑api网关>场景扩展：支撑API网关</h5><p><img src=008eGmZEly1gnaivfvbvuj30w60s4n1i.jpg alt=网易轻舟API网关></p><p><strong>设计要点</strong>：</p><ul><li>扩展Service Mesh技术栈，复用云原生技术成果</li><li>整体设计与可行性验证</li><li>Envoy作为高性能数据面，增强插件扩展能力</li><li>Istio Pilot作为基础控制面，多种扩展接入方式</li><li>API平面设计，屏蔽平台差异，方便平台快捷接入</li></ul><h3 id=results>Results</h3><ul><li>网易严选、传媒、有道、行业平台等业务实现业务落地，<strong>千级服务、万级实例接入</strong></li><li>实现网易微服务基础设施下沉。各业务线研发不再需要过多关注微服务治理，降低业务微服务整体研发与维护成本</li><li>快速引入多语言治理、热升级、故障注入、路由、熔断降级等服务治理能力</li><li>赋能网易集团业务，实现微服务技术栈的统一，向云原生技术方向演进</li><li>作为云原生基础设施长期规划，支撑更多应用场景：API网关、DB&中间件 Mesh、故障演练等。API网关已成为网易API网关标准组件，<strong>支撑网易传媒、严选、Lofter等多个业务核心服务全站流量接入</strong></li><li>网易微服务架构与技术在业界处于领先梯队水平</li></ul></div></div><div class="col-12 blog-post-footer"><hr><a href=/blog/ class=link-grey>← 返回博客列表</a></div></div></section><footer><div class=container><div class="row align-items-center pb-0 footer-logo"><a class=navbar-brand href=/zh><img id=getistio-footer-logo class=img-fluid src=/images/tetrate-istio-distro-logo.png alt="Tetrate Istio Distro | Simple, safe enterprise-grade Istio"></a>
<a href=https://www.tetrate.io target=_blank><img id=tetrate-footer-logo class=img-fluid src=/images/tetrate-logo.svg alt="Tetrate Logo"></a></div><div class="py-4 text-center"><div class=mb-4><ul class="list-inline social-icons text-lg-center text-center"><li class=list-inline-item><a href=https://www.tetrate.io/ target=_blank aria-label="Tetrate website"><i class=ti-world></i></a></li><li class=list-inline-item><a href=https://www.twitter.com/tetrateio target=_blank aria-label="Tetrate Twitter account"><i class=ti-twitter-alt></i></a></li><li class=list-inline-item><a href=https://www.github.com/tetratelabs target=_blank aria-label="Tetrate Github account"><i class=ti-github></i></a></li><li class=list-inline-item><a href=https://www.linkedin.com/company/tetrate/ target=_blank aria-label="Tetrate LinkedIn account"><i class=ti-linkedin></i></a></li></ul></div><small class=text-white>Support: Join our <a href=https://tetr8.io/tetrate-community target=_blank>#tid-and-getmesh Slack Channel</a> for Community Support</small><br><small class=text-white>License: Tetrate Istio Distro is an open source project and is released under Apache License 2.0 | <a href=https://www.tetrate.io/privacy target=_blank>Privacy Statement</a></small><br><small class=text-white>Official project site of istio is <a href=https://www.istio.io target=_blank>istio.io</a></small><br><small class=text-white>Copyright &copy; 2023 <a href=https://www.tetrate.io target=_blank>Tetrate</a> All rights reserved.</small></div></div></footer><script type=text/javascript>var indexURL="/index.json",baseurl="https://istio.tetratelabs.io//zh"</script><script src=/plugins/jQuery/jquery.min.js></script><script src=/plugins/bootstrap/bootstrap.min.js></script><script src=/plugins/featherlight/featherlight.min.js></script><script src=/plugins/clipboard/clipboard.min.js></script><script src=/plugins/match-height/jquery.matchHeight-min.js></script><script src=/plugins/search/auto-complete.js></script><script src=/plugins/search/search.js></script><script src=/plugins/search/lunr.min.js></script><script src=/plugins/search/fuse.min.js></script><script src=/plugins/search/mark.js></script><script src=/plugins/search/search-page.js></script><script src=/js/script.min.js></script><script src=/js/form.min.js></script><script type=text/javascript src="//js.hsforms.net/forms/v2.js?pre=1"></script><script async defer src=https://buttons.github.io/buttons.js></script></body></html>